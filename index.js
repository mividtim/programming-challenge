(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.jiboProgrammingChallenge = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
/// <reference path="../typings/index.d.ts" />
const PIXI = require("pixi.js");
const TweenLite = require("gsap/TweenLite");
const SCREEN_WIDTH = 1280;
const SCREEN_HEIGHT = 720;
const INITIAL_COLS = 20;
const INITIAL_ROWS = 10;
const COLOR_BUTTON = 0x444411;
const COLOR_EVEN = 0xee1111;
const COLOR_ODD = 0x111111;
const COLOR_ARROW = 0xeeeeee;
const COLOR_CHECKER = 0x11eeee;
const BUTTON_WIDTH = 150;
const BUTTON_HEIGHT = 50;
class Game {
    constructor(checker, boardLayout, checkerPosition, squareSize) {
        this.checker = checker;
        this.boardLayout = boardLayout;
        this.checkerPosition = checkerPosition;
        this.squareSize = squareSize;
    }
}
(function () {
    const renderer = new PIXI.WebGLRenderer(SCREEN_WIDTH, SCREEN_HEIGHT);
    document.body.appendChild(renderer.view);
    const stage = new PIXI.Container();
    renderLoop(renderer, stage);
    const gameBoard = new PIXI.Container();
    gameBoard.position = new PIXI.Point(SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2 - BUTTON_HEIGHT / 2);
    stage.addChild(gameBoard);
    const game = newGame(gameBoard, INITIAL_ROWS, INITIAL_COLS);
    createControls(stage, gameBoard, game);
})();
function createControls(stage, gameBoard, game) {
    stage.addChild(createButton(SCREEN_WIDTH / 2 - BUTTON_WIDTH / 2 - 20, SCREEN_HEIGHT - BUTTON_HEIGHT / 2 - 50, 'New Game', () => game = newGame(gameBoard, INITIAL_ROWS, INITIAL_COLS)));
    stage.addChild(createButton(SCREEN_WIDTH / 2 + BUTTON_WIDTH / 2 + 20, SCREEN_HEIGHT - BUTTON_HEIGHT / 2 - 50, 'Play', () => play(game)));
}
function createButton(x, y, label, action) {
    const button = new PIXI.Graphics();
    button.position = new PIXI.Point(x - BUTTON_WIDTH / 2, y - BUTTON_HEIGHT / 2);
    button.lineStyle(2, 0xeeeeee);
    button.beginFill(COLOR_BUTTON);
    button.drawRect(0, 0, BUTTON_WIDTH, BUTTON_HEIGHT);
    button.endFill();
    const text = new PIXI.Text(label, { stroke: 0xeeeeee, fill: 0x111111, strokeThickness: 2, align: 'center', lineJoin: 'round' });
    button.addChild(text);
    button.interactive = true;
    button.on("mouseup", action);
    button.on("touchend", action);
    return button;
}
function newGame(gameBoard, rows, cols) {
    const boardLayout = newBoardLayout(rows, cols);
    const squareSize = Math.min(SCREEN_WIDTH / cols, SCREEN_HEIGHT / rows) * .8;
    createBoard(gameBoard, boardLayout, squareSize);
    const checker = createChecker(squareSize);
    gameBoard.addChild(checker);
    const checkerPosition = randomPosition(boardLayout);
    checker.position = boardPositionToPixels(boardLayout, squareSize, checkerPosition);
    return new Game(checker, boardLayout, checkerPosition, squareSize);
}
function play(game) {
    const rows = game.boardLayout.length;
    const cols = game.boardLayout[0].length;
    const direction = game.boardLayout[game.checkerPosition.x][game.checkerPosition.y];
    let nextPosition;
    switch (direction) {
        case 0 /* Up */:
            game.checkerPosition = new PIXI.Point(game.checkerPosition.x - 1, game.checkerPosition.y);
            break;
        case 2 /* Down */:
            game.checkerPosition = new PIXI.Point(game.checkerPosition.x + 1, game.checkerPosition.y);
            break;
        case 3 /* Left */:
            game.checkerPosition = new PIXI.Point(game.checkerPosition.x, game.checkerPosition.y - 1);
            break;
        case 1 /* Right */:
            game.checkerPosition = new PIXI.Point(game.checkerPosition.x, game.checkerPosition.y + 1);
            break;
    }
    const pixelPosition = boardPositionToPixels(game.boardLayout, game.squareSize, game.checkerPosition);
    TweenLite.to(game.checker.position, .3, { x: pixelPosition.x, y: pixelPosition.y });
    if (game.checkerPosition.x < 0 || game.checkerPosition.x > rows - 1 || game.checkerPosition.y < 0 || game.checkerPosition.y > cols - 1) {
        console.log("Fell off the board!", game.checkerPosition.x, game.checkerPosition.y);
        setTimeout(() => TweenLite.to(game.checker.scale, .5, { x: 0, y: 0 }), 500);
    }
    else {
        game.checker.scale = new PIXI.Point(1, 1);
        setTimeout(() => play(game), 500);
    }
}
function newBoardLayout(rows, cols) {
    const boardLayout = [];
    for (let row = 0; row < rows; row++) {
        boardLayout.push([]);
        for (let col = 0; col < cols; col++) {
            const boardPosition = new PIXI.Point(row, col);
            const arrowDirection = Math.floor(Math.random() * 4);
            boardLayout[row].push(arrowDirection);
        }
    }
    return boardLayout;
}
function createBoard(gameBoard, boardLayout, squareSize) {
    clearContainer(gameBoard);
    const rows = boardLayout.length;
    const cols = boardLayout[0].length;
    let even = false;
    for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
            const boardPosition = new PIXI.Point(row, col);
            const square = createSquare(squareSize, even);
            square.position = boardPositionToPixels(boardLayout, squareSize, boardPosition);
            gameBoard.addChild(square);
            square.addChild(createArrow(squareSize, boardLayout[row][col]));
            even = !even;
        }
        if (rows % 2 === 0)
            even = !even;
    }
    return gameBoard;
}
function createSquare(size, even) {
    const square = new PIXI.Graphics();
    square.beginFill(even ? COLOR_EVEN : COLOR_ODD);
    square.drawRect(-size / 2, -size / 2, size, size);
    square.endFill();
    return square;
}
function createArrow(size, direction) {
    const arrow = new PIXI.Graphics();
    arrow.beginFill(COLOR_ARROW);
    arrow.drawRect(-size / 12, -size * .2, size / 6, size * .6);
    arrow.drawPolygon([
        new PIXI.Point(0, -size * .4),
        new PIXI.Point(-size * .25, -size * .1),
        new PIXI.Point(size * .25, -size * .1)
    ]);
    arrow.endFill();
    arrow.rotation = Math.PI / 2 * direction;
    return arrow;
}
function createChecker(size) {
    const checker = new PIXI.Graphics();
    checker.alpha = .75;
    checker.beginFill(COLOR_CHECKER);
    checker.drawCircle(0, 0, size * .3);
    checker.endFill();
    return checker;
}
function boardPositionToPixels(boardLayout, size, boardPosition) {
    return new PIXI.Point((boardPosition.y - boardLayout[0].length / 2) * size, (boardPosition.x - boardLayout.length / 2) * size);
}
function randomPosition(boardLayout) {
    return new PIXI.Point(Math.floor(Math.random() * boardLayout.length), Math.floor(Math.random() * boardLayout[0].length));
}
function clearContainer(container) {
    container.children.forEach(function (child) { child.destroy(); });
    container.removeChildren();
}
function renderLoop(renderer, stage) {
    requestAnimationFrame(() => renderLoop(renderer, stage));
    renderer.render(stage);
}

},{"gsap/TweenLite":undefined,"pixi.js":undefined}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDQUEsOENBQThDO0FBQzlDLGdDQUFnQztBQUNoQyw0Q0FBNEM7QUFFNUMsTUFBTSxZQUFZLEdBQVUsSUFBSSxDQUFBO0FBQ2hDLE1BQU0sYUFBYSxHQUFVLEdBQUcsQ0FBQTtBQUNoQyxNQUFNLFlBQVksR0FBVSxFQUFFLENBQUE7QUFDOUIsTUFBTSxZQUFZLEdBQVUsRUFBRSxDQUFBO0FBQzlCLE1BQU0sWUFBWSxHQUFVLFFBQVEsQ0FBQTtBQUNwQyxNQUFNLFVBQVUsR0FBVSxRQUFRLENBQUE7QUFDbEMsTUFBTSxTQUFTLEdBQVUsUUFBUSxDQUFBO0FBQ2pDLE1BQU0sV0FBVyxHQUFVLFFBQVEsQ0FBQTtBQUNuQyxNQUFNLGFBQWEsR0FBVSxRQUFRLENBQUE7QUFDckMsTUFBTSxZQUFZLEdBQVUsR0FBRyxDQUFBO0FBQy9CLE1BQU0sYUFBYSxHQUFVLEVBQUUsQ0FBQTtBQVMvQjtJQUtFLFlBQVksT0FBMEIsRUFBRSxXQUFzQixFQUFFLGVBQTBCLEVBQUUsVUFBaUI7UUFDM0csSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7UUFDdEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUE7UUFDOUIsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUE7UUFDdEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUE7SUFDOUIsQ0FBQztDQUNGO0FBRUQsQ0FBQztJQUNDLE1BQU0sUUFBUSxHQUFzQixJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFLGFBQWEsQ0FBQyxDQUFBO0lBQ3ZGLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUN4QyxNQUFNLEtBQUssR0FBa0IsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUE7SUFD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SSxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNsRixTQUFTLENBQUMsY0FBYyxFQUFFLENBQUE7QUFDNUIsQ0FBQztBQUVELG9CQUFvQixRQUEyQixFQUFFLEtBQW9CO0lBQ2pFLHFCQUFxQixDQUFDLE1BQU0sVUFBVSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQ3hELFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7QUFDMUIsQ0FBQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cbmltcG9ydCBQSVhJID0gcmVxdWlyZSgncGl4aS5qcycpXG5pbXBvcnQgVHdlZW5MaXRlID0gcmVxdWlyZSgnZ3NhcC9Ud2VlbkxpdGUnKVxuXG5jb25zdCBTQ1JFRU5fV0lEVEg6bnVtYmVyID0gMTI4MFxuY29uc3QgU0NSRUVOX0hFSUdIVDpudW1iZXIgPSA3MjBcbmNvbnN0IElOSVRJQUxfQ09MUzpudW1iZXIgPSAyMFxuY29uc3QgSU5JVElBTF9ST1dTOm51bWJlciA9IDEwXG5jb25zdCBDT0xPUl9CVVRUT046bnVtYmVyID0gMHg0NDQ0MTFcbmNvbnN0IENPTE9SX0VWRU46bnVtYmVyID0gMHhlZTExMTFcbmNvbnN0IENPTE9SX09ERDpudW1iZXIgPSAweDExMTExMVxuY29uc3QgQ09MT1JfQVJST1c6bnVtYmVyID0gMHhlZWVlZWVcbmNvbnN0IENPTE9SX0NIRUNLRVI6bnVtYmVyID0gMHgxMWVlZWVcbmNvbnN0IEJVVFRPTl9XSURUSDpudW1iZXIgPSAxNTBcbmNvbnN0IEJVVFRPTl9IRUlHSFQ6bnVtYmVyID0gNTBcblxuY29uc3QgZW51bSBESVJFQ1RJT04ge1xuICBVcCA9IDAsXG4gIFJpZ2h0LFxuICBEb3duLFxuICBMZWZ0XG59XG5cbmNsYXNzIEdhbWUge1xuICBjaGVja2VyOlBJWEkuRGlzcGxheU9iamVjdFxuICBib2FyZExheW91dDpudW1iZXJbXVtdXG4gIGNoZWNrZXJQb3NpdGlvbjpQSVhJLlBvaW50XG4gIHNxdWFyZVNpemU6bnVtYmVyXG4gIGNvbnN0cnVjdG9yKGNoZWNrZXI6UElYSS5EaXNwbGF5T2JqZWN0LCBib2FyZExheW91dDpudW1iZXJbXVtdLCBjaGVja2VyUG9zaXRpb246UElYSS5Qb2ludCwgc3F1YXJlU2l6ZTpudW1iZXIpIHtcbiAgICB0aGlzLmNoZWNrZXIgPSBjaGVja2VyXG4gICAgdGhpcy5ib2FyZExheW91dCA9IGJvYXJkTGF5b3V0XG4gICAgdGhpcy5jaGVja2VyUG9zaXRpb24gPSBjaGVja2VyUG9zaXRpb25cbiAgICB0aGlzLnNxdWFyZVNpemUgPSBzcXVhcmVTaXplXG4gIH1cbn1cblxuKGZ1bmN0aW9uKCk6dm9pZCB7XG4gIGNvbnN0IHJlbmRlcmVyOlBJWEkuV2ViR0xSZW5kZXJlciA9IG5ldyBQSVhJLldlYkdMUmVuZGVyZXIoU0NSRUVOX1dJRFRILCBTQ1JFRU5fSEVJR0hUKVxuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJlbmRlcmVyLnZpZXcpXG4gIGNvbnN0IHN0YWdlOlBJWEkuQ29udGFpbmVyID0gbmV3IFBJWEkuQ29udGFpbmVyKClcbiAgcmVuZGVyTG9vcChyZW5kZXJlciwgc3RhZ2UpXG4gIGNvbnN0IGdhbWVCb2FyZDpQSVhJLkNvbnRhaW5lciA9IG5ldyBQSVhJLkNvbnRhaW5lcigpXG4gIGdhbWVCb2FyZC5wb3NpdGlvbiA9IG5ldyBQSVhJLlBvaW50KFNDUkVFTl9XSURUSCAvIDIsIFNDUkVFTl9IRUlHSFQgLyAyIC0gQlVUVE9OX0hFSUdIVCAvIDIpXG4gIHN0YWdlLmFkZENoaWxkKGdhbWVCb2FyZClcbiAgY29uc3QgZ2FtZTpHYW1lID0gbmV3R2FtZShnYW1lQm9hcmQsIElOSVRJQUxfUk9XUywgSU5JVElBTF9DT0xTKVxuICBjcmVhdGVDb250cm9scyhzdGFnZSwgZ2FtZUJvYXJkLCBnYW1lKVxufSkoKVxuXG5mdW5jdGlvbiBjcmVhdGVDb250cm9scyhzdGFnZTpQSVhJLkNvbnRhaW5lciwgZ2FtZUJvYXJkOlBJWEkuQ29udGFpbmVyLCBnYW1lOkdhbWUpIHtcbiAgc3RhZ2UuYWRkQ2hpbGQoY3JlYXRlQnV0dG9uKFxuICAgIFNDUkVFTl9XSURUSCAvIDIgLSBCVVRUT05fV0lEVEggLyAyIC0gMjAsXG4gICAgU0NSRUVOX0hFSUdIVCAtIEJVVFRPTl9IRUlHSFQgLyAyIC0gNTAsXG4gICAgJ05ldyBHYW1lJyxcbiAgICAoKSA9PiBnYW1lID0gbmV3R2FtZShnYW1lQm9hcmQsIElOSVRJQUxfUk9XUywgSU5JVElBTF9DT0xTKSkpXG4gIHN0YWdlLmFkZENoaWxkKGNyZWF0ZUJ1dHRvbihcbiAgICBTQ1JFRU5fV0lEVEggLyAyICsgQlVUVE9OX1dJRFRIIC8gMiArIDIwLFxuICAgIFNDUkVFTl9IRUlHSFQgLSBCVVRUT05fSEVJR0hUIC8gMiAtIDUwLFxuICAgICdQbGF5JyxcbiAgICAoKSA9PiBwbGF5KGdhbWUpKSlcbn1cblxuZnVuY3Rpb24gY3JlYXRlQnV0dG9uKHg6bnVtYmVyLCB5Om51bWJlciwgbGFiZWw6c3RyaW5nLCBhY3Rpb24pOlBJWEkuR3JhcGhpY3Mge1xuICBjb25zdCBidXR0b24gPSBuZXcgUElYSS5HcmFwaGljcygpXG4gIGJ1dHRvbi5wb3NpdGlvbiA9IG5ldyBQSVhJLlBvaW50KHggLSBCVVRUT05fV0lEVEggLyAyLCB5IC0gQlVUVE9OX0hFSUdIVCAvIDIpXG4gIGJ1dHRvbi5saW5lU3R5bGUoMiwgMHhlZWVlZWUpXG4gIGJ1dHRvbi5iZWdpbkZpbGwoQ09MT1JfQlVUVE9OKVxuICBidXR0b24uZHJhd1JlY3QoMCwgMCwgQlVUVE9OX1dJRFRILCBCVVRUT05fSEVJR0hUKVxuICBidXR0b24uZW5kRmlsbCgpXG4gIGNvbnN0IHRleHQ6UElYSS5UZXh0ID0gbmV3IFBJWEkuVGV4dChsYWJlbCwge3N0cm9rZTogMHhlZWVlZWUsIGZpbGw6IDB4MTExMTExLCBzdHJva2VUaGlja25lc3M6IDIsIGFsaWduOiAnY2VudGVyJywgbGluZUpvaW46ICdyb3VuZCd9KVxuICBidXR0b24uYWRkQ2hpbGQodGV4dClcbiAgYnV0dG9uLmludGVyYWN0aXZlID0gdHJ1ZVxuICBidXR0b24ub24oXCJtb3VzZXVwXCIsIGFjdGlvbilcbiAgYnV0dG9uLm9uKFwidG91Y2hlbmRcIiwgYWN0aW9uKVxuICByZXR1cm4gYnV0dG9uXG59XG5cbmZ1bmN0aW9uIG5ld0dhbWUoZ2FtZUJvYXJkOlBJWEkuQ29udGFpbmVyLCByb3dzOm51bWJlciwgY29sczpudW1iZXIpOkdhbWUge1xuICBjb25zdCBib2FyZExheW91dDpudW1iZXJbXVtdID0gbmV3Qm9hcmRMYXlvdXQocm93cywgY29scylcbiAgY29uc3Qgc3F1YXJlU2l6ZTpudW1iZXIgPSBNYXRoLm1pbihTQ1JFRU5fV0lEVEggLyBjb2xzLCBTQ1JFRU5fSEVJR0hUIC8gcm93cykgKiAuOFxuICBjcmVhdGVCb2FyZChnYW1lQm9hcmQsIGJvYXJkTGF5b3V0LCBzcXVhcmVTaXplKVxuICBjb25zdCBjaGVja2VyOlBJWEkuRGlzcGxheU9iamVjdCA9IGNyZWF0ZUNoZWNrZXIoc3F1YXJlU2l6ZSlcbiAgZ2FtZUJvYXJkLmFkZENoaWxkKGNoZWNrZXIpXG4gIGNvbnN0IGNoZWNrZXJQb3NpdGlvbjpQSVhJLlBvaW50ID0gcmFuZG9tUG9zaXRpb24oYm9hcmRMYXlvdXQpXG4gIGNoZWNrZXIucG9zaXRpb24gPSBib2FyZFBvc2l0aW9uVG9QaXhlbHMoYm9hcmRMYXlvdXQsIHNxdWFyZVNpemUsIGNoZWNrZXJQb3NpdGlvbilcbiAgcmV0dXJuIG5ldyBHYW1lKGNoZWNrZXIsIGJvYXJkTGF5b3V0LCBjaGVja2VyUG9zaXRpb24sIHNxdWFyZVNpemUpXG59XG5cbmZ1bmN0aW9uIHBsYXkoZ2FtZTpHYW1lKTp2b2lkIHtcbiAgY29uc3Qgcm93czpudW1iZXIgPSBnYW1lLmJvYXJkTGF5b3V0Lmxlbmd0aFxuICBjb25zdCBjb2xzOm51bWJlciA9IGdhbWUuYm9hcmRMYXlvdXRbMF0ubGVuZ3RoXG4gIGNvbnN0IGRpcmVjdGlvbjpESVJFQ1RJT04gPSBnYW1lLmJvYXJkTGF5b3V0W2dhbWUuY2hlY2tlclBvc2l0aW9uLnhdW2dhbWUuY2hlY2tlclBvc2l0aW9uLnldXG4gIGxldCBuZXh0UG9zaXRpb246UElYSS5Qb2ludFxuICBzd2l0Y2goZGlyZWN0aW9uKSB7XG4gICAgY2FzZSBESVJFQ1RJT04uVXA6XG4gICAgICBnYW1lLmNoZWNrZXJQb3NpdGlvbiA9IG5ldyBQSVhJLlBvaW50KGdhbWUuY2hlY2tlclBvc2l0aW9uLnggLSAxLCBnYW1lLmNoZWNrZXJQb3NpdGlvbi55KVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSBESVJFQ1RJT04uRG93bjpcbiAgICAgIGdhbWUuY2hlY2tlclBvc2l0aW9uID0gbmV3IFBJWEkuUG9pbnQoZ2FtZS5jaGVja2VyUG9zaXRpb24ueCArIDEsIGdhbWUuY2hlY2tlclBvc2l0aW9uLnkpXG4gICAgICBicmVhaztcbiAgICBjYXNlIERJUkVDVElPTi5MZWZ0OlxuICAgICAgZ2FtZS5jaGVja2VyUG9zaXRpb24gPSBuZXcgUElYSS5Qb2ludChnYW1lLmNoZWNrZXJQb3NpdGlvbi54LCBnYW1lLmNoZWNrZXJQb3NpdGlvbi55IC0gMSlcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgRElSRUNUSU9OLlJpZ2h0OlxuICAgICAgZ2FtZS5jaGVja2VyUG9zaXRpb24gPSBuZXcgUElYSS5Qb2ludChnYW1lLmNoZWNrZXJQb3NpdGlvbi54LCBnYW1lLmNoZWNrZXJQb3NpdGlvbi55ICsgMSlcbiAgICAgIGJyZWFrO1xuICB9XG4gIGNvbnN0IHBpeGVsUG9zaXRpb246UElYSS5Qb2ludCA9IGJvYXJkUG9zaXRpb25Ub1BpeGVscyhnYW1lLmJvYXJkTGF5b3V0LCBnYW1lLnNxdWFyZVNpemUsIGdhbWUuY2hlY2tlclBvc2l0aW9uKVxuICBUd2VlbkxpdGUudG8oZ2FtZS5jaGVja2VyLnBvc2l0aW9uLCAuMywge3g6IHBpeGVsUG9zaXRpb24ueCwgeTogcGl4ZWxQb3NpdGlvbi55fSlcbiAgaWYoZ2FtZS5jaGVja2VyUG9zaXRpb24ueCA8IDAgfHwgZ2FtZS5jaGVja2VyUG9zaXRpb24ueCA+IHJvd3MgLSAxIHx8IGdhbWUuY2hlY2tlclBvc2l0aW9uLnkgPCAwIHx8IGdhbWUuY2hlY2tlclBvc2l0aW9uLnkgPiBjb2xzIC0gMSkge1xuICAgIGNvbnNvbGUubG9nKFwiRmVsbCBvZmYgdGhlIGJvYXJkIVwiLCBnYW1lLmNoZWNrZXJQb3NpdGlvbi54LCBnYW1lLmNoZWNrZXJQb3NpdGlvbi55KVxuICAgIHNldFRpbWVvdXQoKCkgPT4gVHdlZW5MaXRlLnRvKGdhbWUuY2hlY2tlci5zY2FsZSwgLjUsIHt4OiAwLCB5OiAwfSksIDUwMClcbiAgfVxuICBlbHNlIHtcbiAgICBnYW1lLmNoZWNrZXIuc2NhbGUgPSBuZXcgUElYSS5Qb2ludCgxLCAxKVxuICAgIHNldFRpbWVvdXQoKCkgPT4gcGxheShnYW1lKSwgNTAwKVxuICB9XG59XG5cbmZ1bmN0aW9uIG5ld0JvYXJkTGF5b3V0KHJvd3MsIGNvbHMpOm51bWJlcltdW10ge1xuICBjb25zdCBib2FyZExheW91dDpudW1iZXJbXVtdID0gW11cbiAgZm9yKGxldCByb3c6bnVtYmVyID0gMCA7IHJvdyA8IHJvd3MgOyByb3crKykge1xuICAgIGJvYXJkTGF5b3V0LnB1c2goW10pXG4gICAgZm9yKGxldCBjb2w6bnVtYmVyID0gMCA7IGNvbCA8IGNvbHMgOyBjb2wrKykge1xuICAgICAgY29uc3QgYm9hcmRQb3NpdGlvbjpQSVhJLlBvaW50ID0gbmV3IFBJWEkuUG9pbnQocm93LCBjb2wpXG4gICAgICBjb25zdCBhcnJvd0RpcmVjdGlvbjpESVJFQ1RJT04gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KVxuICAgICAgYm9hcmRMYXlvdXRbcm93XS5wdXNoKGFycm93RGlyZWN0aW9uKVxuICAgIH1cbiAgfVxuICByZXR1cm4gYm9hcmRMYXlvdXRcbn1cblxuZnVuY3Rpb24gY3JlYXRlQm9hcmQoZ2FtZUJvYXJkOlBJWEkuQ29udGFpbmVyLCBib2FyZExheW91dDpudW1iZXJbXVtdLCBzcXVhcmVTaXplOm51bWJlcik6UElYSS5Db250YWluZXIge1xuICBjbGVhckNvbnRhaW5lcihnYW1lQm9hcmQpXG4gIGNvbnN0IHJvd3MgPSBib2FyZExheW91dC5sZW5ndGhcbiAgY29uc3QgY29scyA9IGJvYXJkTGF5b3V0WzBdLmxlbmd0aFxuICBsZXQgZXZlbjpib29sZWFuID0gZmFsc2VcbiAgZm9yKGxldCByb3c6bnVtYmVyID0gMCA7IHJvdyA8IHJvd3MgOyByb3crKykge1xuICAgIGZvcihsZXQgY29sOm51bWJlciA9IDAgOyBjb2wgPCBjb2xzIDsgY29sKyspIHtcbiAgICAgIGNvbnN0IGJvYXJkUG9zaXRpb246UElYSS5Qb2ludCA9IG5ldyBQSVhJLlBvaW50KHJvdywgY29sKVxuICAgICAgY29uc3Qgc3F1YXJlOlBJWEkuR3JhcGhpY3MgPSBjcmVhdGVTcXVhcmUoc3F1YXJlU2l6ZSwgZXZlbilcbiAgICAgIHNxdWFyZS5wb3NpdGlvbiA9IGJvYXJkUG9zaXRpb25Ub1BpeGVscyhib2FyZExheW91dCwgc3F1YXJlU2l6ZSwgYm9hcmRQb3NpdGlvbilcbiAgICAgIGdhbWVCb2FyZC5hZGRDaGlsZChzcXVhcmUpXG4gICAgICBzcXVhcmUuYWRkQ2hpbGQoY3JlYXRlQXJyb3coc3F1YXJlU2l6ZSwgYm9hcmRMYXlvdXRbcm93XVtjb2xdKSlcbiAgICAgIGV2ZW4gPSAhZXZlblxuICAgIH1cbiAgICBpZihyb3dzICUgMiA9PT0gMClcbiAgICAgIGV2ZW4gPSAhZXZlblxuICB9XG4gIHJldHVybiBnYW1lQm9hcmRcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3F1YXJlKHNpemU6bnVtYmVyLCBldmVuOmJvb2xlYW4pOlBJWEkuR3JhcGhpY3Mge1xuICBjb25zdCBzcXVhcmU6UElYSS5HcmFwaGljcyA9IG5ldyBQSVhJLkdyYXBoaWNzKClcbiAgc3F1YXJlLmJlZ2luRmlsbChldmVuID8gQ09MT1JfRVZFTiA6IENPTE9SX09ERClcbiAgc3F1YXJlLmRyYXdSZWN0KC1zaXplIC8gMiwgLXNpemUgLyAyLCBzaXplLCBzaXplKVxuICBzcXVhcmUuZW5kRmlsbCgpXG4gIHJldHVybiBzcXVhcmVcbn1cblxuZnVuY3Rpb24gY3JlYXRlQXJyb3coc2l6ZTpudW1iZXIsIGRpcmVjdGlvbjpESVJFQ1RJT04pOlBJWEkuR3JhcGhpY3Mge1xuICBjb25zdCBhcnJvdzpQSVhJLkdyYXBoaWNzID0gbmV3IFBJWEkuR3JhcGhpY3MoKVxuICBhcnJvdy5iZWdpbkZpbGwoQ09MT1JfQVJST1cpXG4gIGFycm93LmRyYXdSZWN0KC1zaXplIC8gMTIsIC1zaXplICogLjIsIHNpemUgLyA2LCBzaXplICogLjYpXG4gIGFycm93LmRyYXdQb2x5Z29uKFtcbiAgICBuZXcgUElYSS5Qb2ludCgwLCAtc2l6ZSAqIC40KSxcbiAgICBuZXcgUElYSS5Qb2ludCgtc2l6ZSAqIC4yNSwgLXNpemUgKiAuMSksXG4gICAgbmV3IFBJWEkuUG9pbnQoc2l6ZSAqIC4yNSwgLXNpemUgKiAuMSlcbiAgXSlcbiAgYXJyb3cuZW5kRmlsbCgpXG4gIGFycm93LnJvdGF0aW9uID0gTWF0aC5QSSAvIDIgKiBkaXJlY3Rpb25cbiAgcmV0dXJuIGFycm93XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNoZWNrZXIoc2l6ZTpudW1iZXIpOlBJWEkuR3JhcGhpY3Mge1xuICBjb25zdCBjaGVja2VyOlBJWEkuR3JhcGhpY3MgPSBuZXcgUElYSS5HcmFwaGljcygpXG4gIGNoZWNrZXIuYWxwaGEgPSAuNzVcbiAgY2hlY2tlci5iZWdpbkZpbGwoQ09MT1JfQ0hFQ0tFUilcbiAgY2hlY2tlci5kcmF3Q2lyY2xlKDAsIDAsIHNpemUgKiAuMylcbiAgY2hlY2tlci5lbmRGaWxsKClcbiAgcmV0dXJuIGNoZWNrZXJcbn1cblxuZnVuY3Rpb24gYm9hcmRQb3NpdGlvblRvUGl4ZWxzKGJvYXJkTGF5b3V0Om51bWJlcltdW10sIHNpemU6bnVtYmVyLCBib2FyZFBvc2l0aW9uOlBJWEkuUG9pbnQpOlBJWEkuUG9pbnQge1xuICByZXR1cm4gbmV3IFBJWEkuUG9pbnQoXG4gICAgKGJvYXJkUG9zaXRpb24ueSAtIGJvYXJkTGF5b3V0WzBdLmxlbmd0aCAvIDIpICogc2l6ZSxcbiAgICAoYm9hcmRQb3NpdGlvbi54IC0gYm9hcmRMYXlvdXQubGVuZ3RoIC8gMikgKiBzaXplXG4gIClcbn1cblxuZnVuY3Rpb24gcmFuZG9tUG9zaXRpb24oYm9hcmRMYXlvdXQ6bnVtYmVyW11bXSk6UElYSS5Qb2ludCB7XG4gIHJldHVybiBuZXcgUElYSS5Qb2ludChcbiAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGJvYXJkTGF5b3V0Lmxlbmd0aCksXG4gICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBib2FyZExheW91dFswXS5sZW5ndGgpXG4gIClcbn1cblxuZnVuY3Rpb24gY2xlYXJDb250YWluZXIoY29udGFpbmVyOlBJWEkuQ29udGFpbmVyKTp2b2lkIHtcbiAgY29udGFpbmVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oY2hpbGQ6UElYSS5EaXNwbGF5T2JqZWN0KSB7IGNoaWxkLmRlc3Ryb3koKSB9KVxuICBjb250YWluZXIucmVtb3ZlQ2hpbGRyZW4oKVxufVxuXG5mdW5jdGlvbiByZW5kZXJMb29wKHJlbmRlcmVyOlBJWEkuV2ViR0xSZW5kZXJlciwgc3RhZ2U6UElYSS5Db250YWluZXIpOnZvaWQge1xuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiByZW5kZXJMb29wKHJlbmRlcmVyLCBzdGFnZSkpXG4gICAgcmVuZGVyZXIucmVuZGVyKHN0YWdlKVxufVxuIl19
