(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.jiboProgrammingChallenge = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
/// <reference path="../typings/index.d.ts" />
const PIXI = require("pixi.js");
const TweenLite = require("gsap/TweenLite");
const SCREEN_WIDTH = 1280;
const SCREEN_HEIGHT = 720;
const INITIAL_COLS = 20;
const INITIAL_ROWS = 10;
const COLOR_BUTTON = 0x444411;
const COLOR_EVEN = 0xee1111;
const COLOR_ODD = 0x111111;
const COLOR_ARROW = 0xeeeeee;
const COLOR_CHECKER = 0x11eeee;
const BUTTON_WIDTH = 150;
const BUTTON_HEIGHT = 50;
class Game {
    constructor(checker1, checker2, boardLayout, startingPosition, squareSize) {
        this.checker1 = checker1;
        this.checker2 = checker2;
        this.boardLayout = boardLayout;
        this.startingPosition = startingPosition;
        this.squareSize = squareSize;
    }
}
(function () {
    const renderer = new PIXI.WebGLRenderer(SCREEN_WIDTH, SCREEN_HEIGHT);
    document.body.appendChild(renderer.view);
    const stage = new PIXI.Container();
    renderLoop(renderer, stage);
    const gameBoard = new PIXI.Container();
    gameBoard.position = new PIXI.Point(SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2 - BUTTON_HEIGHT / 2);
    stage.addChild(gameBoard);
    const game = newGame(gameBoard, INITIAL_ROWS, INITIAL_COLS);
    createControls(stage, gameBoard, game);
})();
function createControls(stage, gameBoard, game) {
    stage.addChild(createButton(SCREEN_WIDTH / 2 - BUTTON_WIDTH / 2 - 20, SCREEN_HEIGHT - BUTTON_HEIGHT / 2 - 50, 'New Game', () => game = newGame(gameBoard, INITIAL_ROWS, INITIAL_COLS)));
    stage.addChild(createButton(SCREEN_WIDTH / 2 + BUTTON_WIDTH / 2 + 20, SCREEN_HEIGHT - BUTTON_HEIGHT / 2 - 50, 'Play', () => play(game)));
}
function createButton(x, y, label, action) {
    const button = new PIXI.Graphics();
    button.position = new PIXI.Point(x - BUTTON_WIDTH / 2, y - BUTTON_HEIGHT / 2);
    button.lineStyle(2, 0xeeeeee);
    button.beginFill(COLOR_BUTTON);
    button.drawRect(0, 0, BUTTON_WIDTH, BUTTON_HEIGHT);
    button.endFill();
    const text = new PIXI.Text(label, { stroke: 0xeeeeee, fill: 0x111111, strokeThickness: 2, align: 'center', lineJoin: 'round' });
    button.addChild(text);
    button.interactive = true;
    button.on("mouseup", action);
    button.on("touchend", action);
    return button;
}
function newGame(gameBoard, rows, cols) {
    const boardLayout = newBoardLayout(rows, cols);
    const squareSize = Math.min(SCREEN_WIDTH / cols, SCREEN_HEIGHT / rows) * .8;
    createBoard(gameBoard, boardLayout, squareSize);
    const startingPosition = randomPosition(boardLayout);
    const checker1 = createChecker(squareSize);
    gameBoard.addChild(checker1);
    checker1.position = boardPositionToPixels(boardLayout, squareSize, startingPosition);
    const checker2 = createChecker(squareSize);
    gameBoard.addChild(checker2);
    checker2.position = boardPositionToPixels(boardLayout, squareSize, startingPosition);
    return new Game(checker1, checker2, boardLayout, startingPosition, squareSize);
}
function play(game, checker1Position = null, checker2Position = null, evenMove = false) {
    if (!checker1Position) {
        checker1Position = new PIXI.Point(game.startingPosition.x, game.startingPosition.y);
        checker2Position = new PIXI.Point(game.startingPosition.x, game.startingPosition.y);
    }
    let gameEnded = false;
    checker1Position = moveChecker(game.checker1, checker1Position, game.boardLayout, game.squareSize);
    // Have to check before moving the second checker
    gameEnded = testEndGame(game.boardLayout, checker1Position, checker2Position);
    if (!gameEnded && evenMove) {
        checker2Position = moveChecker(game.checker2, checker2Position, game.boardLayout, game.squareSize);
        gameEnded = testEndGame(game.boardLayout, checker1Position, checker2Position);
    }
    if (gameEnded)
        TweenLite.to(game.checker1.scale, .5, { x: 0, y: 0 });
    else
        setTimeout(() => play(game, checker1Position, checker2Position, !evenMove), 500);
}
function moveChecker(checker, currentPosition, boardLayout, squareSize) {
    const direction = boardLayout[currentPosition.x][currentPosition.y];
    let nextPosition;
    switch (direction) {
        case 0 /* Up */:
            nextPosition = new PIXI.Point(currentPosition.x - 1, currentPosition.y);
            break;
        case 2 /* Down */:
            nextPosition = new PIXI.Point(currentPosition.x + 1, currentPosition.y);
            break;
        case 3 /* Left */:
            nextPosition = new PIXI.Point(currentPosition.x, currentPosition.y - 1);
            break;
        case 1 /* Right */:
            nextPosition = new PIXI.Point(currentPosition.x, currentPosition.y + 1);
            break;
    }
    const pixelPosition = boardPositionToPixels(boardLayout, squareSize, nextPosition);
    TweenLite.to(checker.position, .3, { x: pixelPosition.x, y: pixelPosition.y });
    return nextPosition;
}
function testEndGame(boardLayout, checker1Position, checker2Position) {
    let endGame = false;
    if (!validPosition(boardLayout, checker1Position)) {
        console.info('The path is noncircular');
        endGame = true;
    }
    else if (samePosition(checker1Position, checker2Position)) {
        console.info('The path is circular');
        endGame = true;
    }
    return endGame;
}
function validPosition(boardLayout, position) {
    return !(position.x < 0 ||
        position.x > boardLayout.length - 1 ||
        position.y < 0 ||
        position.y > boardLayout[0].length - 1);
}
function samePosition(position1, position2) {
    return position1.x === position2.x && position1.y === position2.y;
}
function newBoardLayout(rows, cols) {
    const boardLayout = [];
    for (let row = 0; row < rows; row++) {
        boardLayout.push([]);
        for (let col = 0; col < cols; col++) {
            const boardPosition = new PIXI.Point(row, col);
            const arrowDirection = Math.floor(Math.random() * 4);
            boardLayout[row].push(arrowDirection);
        }
    }
    return boardLayout;
}
function createBoard(gameBoard, boardLayout, squareSize) {
    clearContainer(gameBoard);
    const rows = boardLayout.length;
    const cols = boardLayout[0].length;
    let even = false;
    for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
            const boardPosition = new PIXI.Point(row, col);
            const square = createSquare(squareSize, even);
            square.position = boardPositionToPixels(boardLayout, squareSize, boardPosition);
            gameBoard.addChild(square);
            square.addChild(createArrow(squareSize, boardLayout[row][col]));
            even = !even;
        }
        if (rows % 2 === 0)
            even = !even;
    }
    return gameBoard;
}
function createSquare(size, even) {
    const square = new PIXI.Graphics();
    square.beginFill(even ? COLOR_EVEN : COLOR_ODD);
    square.drawRect(-size / 2, -size / 2, size, size);
    square.endFill();
    return square;
}
function createArrow(size, direction) {
    const arrow = new PIXI.Graphics();
    arrow.beginFill(COLOR_ARROW);
    arrow.drawRect(-size / 12, -size * .2, size / 6, size * .6);
    arrow.drawPolygon([
        new PIXI.Point(0, -size * .4),
        new PIXI.Point(-size * .25, -size * .1),
        new PIXI.Point(size * .25, -size * .1)
    ]);
    arrow.endFill();
    arrow.rotation = Math.PI / 2 * direction;
    return arrow;
}
function createChecker(size) {
    const checker = new PIXI.Graphics();
    checker.alpha = .75;
    checker.beginFill(COLOR_CHECKER);
    checker.drawCircle(0, 0, size * .3);
    checker.endFill();
    return checker;
}
function boardPositionToPixels(boardLayout, size, boardPosition) {
    return new PIXI.Point((boardPosition.y - boardLayout[0].length / 2) * size, (boardPosition.x - boardLayout.length / 2) * size);
}
function randomPosition(boardLayout) {
    return new PIXI.Point(Math.floor(Math.random() * boardLayout.length), Math.floor(Math.random() * boardLayout[0].length));
}
function clearContainer(container) {
    container.children.forEach(function (child) { child.destroy(); });
    container.removeChildren();
}
function renderLoop(renderer, stage) {
    requestAnimationFrame(() => renderLoop(renderer, stage));
    renderer.render(stage);
}

},{"gsap/TweenLite":undefined,"pixi.js":undefined}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDQUEsOENBQThDO0FBQzlDLGdDQUFnQztBQUNoQyw0Q0FBNEM7QUFFNUMsTUFBTSxZQUFZLEdBQVUsSUFBSSxDQUFBO0FBQ2hDLE1BQU0sYUFBYSxHQUFVLEdBQUcsQ0FBQTtBQUNoQyxNQUFNLFlBQVksR0FBVSxFQUFFLENBQUE7QUFDOUIsTUFBTSxZQUFZLEdBQVUsRUFBRSxDQUFBO0FBQzlCLE1BQU0sWUFBWSxHQUFVLFFBQVEsQ0FBQTtBQUNwQyxNQUFNLFVBQVUsR0FBVSxRQUFRLENBQUE7QUFDbEMsTUFBTSxTQUFTLEdBQVUsUUFBUSxDQUFBO0FBQ2pDLE1BQU0sV0FBVyxHQUFVLFFBQVEsQ0FBQTtBQUNuQyxNQUFNLGFBQWEsR0FBVSxRQUFRLENBQUE7QUFDckMsTUFBTSxZQUFZLEdBQVUsR0FBRyxDQUFBO0FBQy9CLE1BQU0sYUFBYSxHQUFVLEVBQUUsQ0FBQTtBQVMvQjtJQU1FLFlBQVksUUFBMkIsRUFBRSxRQUEyQixFQUFFLFdBQXNCLEVBQUUsZ0JBQTJCLEVBQUUsVUFBaUI7UUFDMUksSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUE7UUFDeEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUE7UUFDeEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUE7UUFDOUIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGdCQUFnQixDQUFBO1FBQ3hDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFBO0lBQzlCLENBQUM7Q0FDRjtBQUVELENBQUM7SUFDQyxNQUFNLFFBQVEsR0FBc0IsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksRUFBRSxhQUFhLENBQUMsQ0FBQTtJQUN2RixRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUE7SUFD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LElBQUksQ0FDbEQsQ0FBQTtBQUNILENBQUM7QUFFRCx3QkFBd0IsV0FBc0I7SUFDNUMsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FDakIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxFQUM5QyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQ3BELENBQUE7QUFDSCxDQUFDO0FBRUQsd0JBQXdCLFNBQXdCO0lBQzlDLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQVMsS0FBd0IsSUFBSSxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNsRixTQUFTLENBQUMsY0FBYyxFQUFFLENBQUE7QUFDNUIsQ0FBQztBQUVELG9CQUFvQixRQUEyQixFQUFFLEtBQW9CO0lBQ2pFLHFCQUFxQixDQUFDLE1BQU0sVUFBVSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQ3hELFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7QUFDMUIsQ0FBQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cbmltcG9ydCBQSVhJID0gcmVxdWlyZSgncGl4aS5qcycpXG5pbXBvcnQgVHdlZW5MaXRlID0gcmVxdWlyZSgnZ3NhcC9Ud2VlbkxpdGUnKVxuXG5jb25zdCBTQ1JFRU5fV0lEVEg6bnVtYmVyID0gMTI4MFxuY29uc3QgU0NSRUVOX0hFSUdIVDpudW1iZXIgPSA3MjBcbmNvbnN0IElOSVRJQUxfQ09MUzpudW1iZXIgPSAyMFxuY29uc3QgSU5JVElBTF9ST1dTOm51bWJlciA9IDEwXG5jb25zdCBDT0xPUl9CVVRUT046bnVtYmVyID0gMHg0NDQ0MTFcbmNvbnN0IENPTE9SX0VWRU46bnVtYmVyID0gMHhlZTExMTFcbmNvbnN0IENPTE9SX09ERDpudW1iZXIgPSAweDExMTExMVxuY29uc3QgQ09MT1JfQVJST1c6bnVtYmVyID0gMHhlZWVlZWVcbmNvbnN0IENPTE9SX0NIRUNLRVI6bnVtYmVyID0gMHgxMWVlZWVcbmNvbnN0IEJVVFRPTl9XSURUSDpudW1iZXIgPSAxNTBcbmNvbnN0IEJVVFRPTl9IRUlHSFQ6bnVtYmVyID0gNTBcblxuY29uc3QgZW51bSBESVJFQ1RJT04ge1xuICBVcCA9IDAsXG4gIFJpZ2h0LFxuICBEb3duLFxuICBMZWZ0XG59XG5cbmNsYXNzIEdhbWUge1xuICBjaGVja2VyMTpQSVhJLkRpc3BsYXlPYmplY3RcbiAgY2hlY2tlcjI6UElYSS5EaXNwbGF5T2JqZWN0XG4gIGJvYXJkTGF5b3V0Om51bWJlcltdW11cbiAgc3RhcnRpbmdQb3NpdGlvbjpQSVhJLlBvaW50XG4gIHNxdWFyZVNpemU6bnVtYmVyXG4gIGNvbnN0cnVjdG9yKGNoZWNrZXIxOlBJWEkuRGlzcGxheU9iamVjdCwgY2hlY2tlcjI6UElYSS5EaXNwbGF5T2JqZWN0LCBib2FyZExheW91dDpudW1iZXJbXVtdLCBzdGFydGluZ1Bvc2l0aW9uOlBJWEkuUG9pbnQsIHNxdWFyZVNpemU6bnVtYmVyKSB7XG4gICAgdGhpcy5jaGVja2VyMSA9IGNoZWNrZXIxXG4gICAgdGhpcy5jaGVja2VyMiA9IGNoZWNrZXIyXG4gICAgdGhpcy5ib2FyZExheW91dCA9IGJvYXJkTGF5b3V0XG4gICAgdGhpcy5zdGFydGluZ1Bvc2l0aW9uID0gc3RhcnRpbmdQb3NpdGlvblxuICAgIHRoaXMuc3F1YXJlU2l6ZSA9IHNxdWFyZVNpemVcbiAgfVxufVxuXG4oZnVuY3Rpb24oKTp2b2lkIHtcbiAgY29uc3QgcmVuZGVyZXI6UElYSS5XZWJHTFJlbmRlcmVyID0gbmV3IFBJWEkuV2ViR0xSZW5kZXJlcihTQ1JFRU5fV0lEVEgsIFNDUkVFTl9IRUlHSFQpXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVuZGVyZXIudmlldylcbiAgY29uc3Qgc3RhZ2U6UElYSS5Db250YWluZXIgPSBuZXcgUElYSS5Db250YWluZXIoKVxuICByZW5kZXJMb29wKHJlbmRlcmVyLCBzdGFnZSlcbiAgY29uc3QgZ2FtZUJvYXJkOlBJWEkuQ29udGFpbmVyID0gbmV3IFBJWEkuQ29udGFpbmVyKClcbiAgZ2FtZUJvYXJkLnBvc2l0aW9uID0gbmV3IFBJWEkuUG9pbnQoU0NSRUVOX1dJRFRIIC8gMiwgU0NSRUVOX0hFSUdIVCAvIDIgLSBCVVRUT05fSEVJR0hUIC8gMilcbiAgc3RhZ2UuYWRkQ2hpbGQoZ2FtZUJvYXJkKVxuICBjb25zdCBnYW1lOkdhbWUgPSBuZXdHYW1lKGdhbWVCb2FyZCwgSU5JVElBTF9ST1dTLCBJTklUSUFMX0NPTFMpXG4gIGNyZWF0ZUNvbnRyb2xzKHN0YWdlLCBnYW1lQm9hcmQsIGdhbWUpXG59KSgpXG5cbmZ1bmN0aW9uIGNyZWF0ZUNvbnRyb2xzKHN0YWdlOlBJWEkuQ29udGFpbmVyLCBnYW1lQm9hcmQ6UElYSS5Db250YWluZXIsIGdhbWU6R2FtZSkge1xuICBzdGFnZS5hZGRDaGlsZChjcmVhdGVCdXR0b24oXG4gICAgU0NSRUVOX1dJRFRIIC8gMiAtIEJVVFRPTl9XSURUSCAvIDIgLSAyMCxcbiAgICBTQ1JFRU5fSEVJR0hUIC0gQlVUVE9OX0hFSUdIVCAvIDIgLSA1MCxcbiAgICAnTmV3IEdhbWUnLFxuICAgICgpID0+IGdhbWUgPSBuZXdHYW1lKGdhbWVCb2FyZCwgSU5JVElBTF9ST1dTLCBJTklUSUFMX0NPTFMpKSlcbiAgc3RhZ2UuYWRkQ2hpbGQoY3JlYXRlQnV0dG9uKFxuICAgIFNDUkVFTl9XSURUSCAvIDIgKyBCVVRUT05fV0lEVEggLyAyICsgMjAsXG4gICAgU0NSRUVOX0hFSUdIVCAtIEJVVFRPTl9IRUlHSFQgLyAyIC0gNTAsXG4gICAgJ1BsYXknLFxuICAgICgpID0+IHBsYXkoZ2FtZSkpKVxufVxuXG5mdW5jdGlvbiBjcmVhdGVCdXR0b24oeDpudW1iZXIsIHk6bnVtYmVyLCBsYWJlbDpzdHJpbmcsIGFjdGlvbik6UElYSS5HcmFwaGljcyB7XG4gIGNvbnN0IGJ1dHRvbiA9IG5ldyBQSVhJLkdyYXBoaWNzKClcbiAgYnV0dG9uLnBvc2l0aW9uID0gbmV3IFBJWEkuUG9pbnQoeCAtIEJVVFRPTl9XSURUSCAvIDIsIHkgLSBCVVRUT05fSEVJR0hUIC8gMilcbiAgYnV0dG9uLmxpbmVTdHlsZSgyLCAweGVlZWVlZSlcbiAgYnV0dG9uLmJlZ2luRmlsbChDT0xPUl9CVVRUT04pXG4gIGJ1dHRvbi5kcmF3UmVjdCgwLCAwLCBCVVRUT05fV0lEVEgsIEJVVFRPTl9IRUlHSFQpXG4gIGJ1dHRvbi5lbmRGaWxsKClcbiAgY29uc3QgdGV4dDpQSVhJLlRleHQgPSBuZXcgUElYSS5UZXh0KGxhYmVsLCB7c3Ryb2tlOiAweGVlZWVlZSwgZmlsbDogMHgxMTExMTEsIHN0cm9rZVRoaWNrbmVzczogMiwgYWxpZ246ICdjZW50ZXInLCBsaW5lSm9pbjogJ3JvdW5kJ30pXG4gIGJ1dHRvbi5hZGRDaGlsZCh0ZXh0KVxuICBidXR0b24uaW50ZXJhY3RpdmUgPSB0cnVlXG4gIGJ1dHRvbi5vbihcIm1vdXNldXBcIiwgYWN0aW9uKVxuICBidXR0b24ub24oXCJ0b3VjaGVuZFwiLCBhY3Rpb24pXG4gIHJldHVybiBidXR0b25cbn1cblxuZnVuY3Rpb24gbmV3R2FtZShnYW1lQm9hcmQ6UElYSS5Db250YWluZXIsIHJvd3M6bnVtYmVyLCBjb2xzOm51bWJlcik6R2FtZSB7XG4gIGNvbnN0IGJvYXJkTGF5b3V0Om51bWJlcltdW10gPSBuZXdCb2FyZExheW91dChyb3dzLCBjb2xzKVxuICBjb25zdCBzcXVhcmVTaXplOm51bWJlciA9IE1hdGgubWluKFNDUkVFTl9XSURUSCAvIGNvbHMsIFNDUkVFTl9IRUlHSFQgLyByb3dzKSAqIC44XG4gIGNyZWF0ZUJvYXJkKGdhbWVCb2FyZCwgYm9hcmRMYXlvdXQsIHNxdWFyZVNpemUpXG4gIGNvbnN0IHN0YXJ0aW5nUG9zaXRpb246UElYSS5Qb2ludCA9IHJhbmRvbVBvc2l0aW9uKGJvYXJkTGF5b3V0KVxuICBjb25zdCBjaGVja2VyMTpQSVhJLkRpc3BsYXlPYmplY3QgPSBjcmVhdGVDaGVja2VyKHNxdWFyZVNpemUpXG4gIGdhbWVCb2FyZC5hZGRDaGlsZChjaGVja2VyMSlcbiAgY2hlY2tlcjEucG9zaXRpb24gPSBib2FyZFBvc2l0aW9uVG9QaXhlbHMoYm9hcmRMYXlvdXQsIHNxdWFyZVNpemUsIHN0YXJ0aW5nUG9zaXRpb24pXG4gIGNvbnN0IGNoZWNrZXIyOlBJWEkuRGlzcGxheU9iamVjdCA9IGNyZWF0ZUNoZWNrZXIoc3F1YXJlU2l6ZSlcbiAgZ2FtZUJvYXJkLmFkZENoaWxkKGNoZWNrZXIyKVxuICBjaGVja2VyMi5wb3NpdGlvbiA9IGJvYXJkUG9zaXRpb25Ub1BpeGVscyhib2FyZExheW91dCwgc3F1YXJlU2l6ZSwgc3RhcnRpbmdQb3NpdGlvbilcbiAgcmV0dXJuIG5ldyBHYW1lKGNoZWNrZXIxLCBjaGVja2VyMiwgYm9hcmRMYXlvdXQsIHN0YXJ0aW5nUG9zaXRpb24sIHNxdWFyZVNpemUpXG59XG5cbmZ1bmN0aW9uIHBsYXkoZ2FtZTpHYW1lLCBjaGVja2VyMVBvc2l0aW9uOlBJWEkuUG9pbnQgPSBudWxsLCBjaGVja2VyMlBvc2l0aW9uOlBJWEkuUG9pbnQgPSBudWxsLCBldmVuTW92ZTpib29sZWFuID0gZmFsc2UpOnZvaWQge1xuICBpZighY2hlY2tlcjFQb3NpdGlvbikge1xuICAgIGNoZWNrZXIxUG9zaXRpb24gPSBuZXcgUElYSS5Qb2ludChnYW1lLnN0YXJ0aW5nUG9zaXRpb24ueCwgZ2FtZS5zdGFydGluZ1Bvc2l0aW9uLnkpXG4gICAgY2hlY2tlcjJQb3NpdGlvbiA9IG5ldyBQSVhJLlBvaW50KGdhbWUuc3RhcnRpbmdQb3NpdGlvbi54LCBnYW1lLnN0YXJ0aW5nUG9zaXRpb24ueSlcbiAgfVxuICBsZXQgZ2FtZUVuZGVkOmJvb2xlYW4gPSBmYWxzZVxuICBjaGVja2VyMVBvc2l0aW9uID0gbW92ZUNoZWNrZXIoZ2FtZS5jaGVja2VyMSwgY2hlY2tlcjFQb3NpdGlvbiwgZ2FtZS5ib2FyZExheW91dCwgZ2FtZS5zcXVhcmVTaXplKVxuICAvLyBIYXZlIHRvIGNoZWNrIGJlZm9yZSBtb3ZpbmcgdGhlIHNlY29uZCBjaGVja2VyXG4gIGdhbWVFbmRlZCA9IHRlc3RFbmRHYW1lKGdhbWUuYm9hcmRMYXlvdXQsIGNoZWNrZXIxUG9zaXRpb24sIGNoZWNrZXIyUG9zaXRpb24pXG4gIGlmKCFnYW1lRW5kZWQgJiYgZXZlbk1vdmUpIHtcbiAgICBjaGVja2VyMlBvc2l0aW9uID0gbW92ZUNoZWNrZXIoZ2FtZS5jaGVja2VyMiwgY2hlY2tlcjJQb3NpdGlvbiwgZ2FtZS5ib2FyZExheW91dCwgZ2FtZS5zcXVhcmVTaXplKVxuICAgIGdhbWVFbmRlZCA9IHRlc3RFbmRHYW1lKGdhbWUuYm9hcmRMYXlvdXQsIGNoZWNrZXIxUG9zaXRpb24sIGNoZWNrZXIyUG9zaXRpb24pXG4gIH1cbiAgaWYoZ2FtZUVuZGVkKVxuICAgIFR3ZWVuTGl0ZS50byhnYW1lLmNoZWNrZXIxLnNjYWxlLCAuNSwge3g6IDAsIHk6IDB9KVxuICBlbHNlXG4gICAgc2V0VGltZW91dCgoKSA9PiBwbGF5KGdhbWUsIGNoZWNrZXIxUG9zaXRpb24sIGNoZWNrZXIyUG9zaXRpb24sICFldmVuTW92ZSksIDUwMClcbn1cblxuZnVuY3Rpb24gbW92ZUNoZWNrZXIoY2hlY2tlcjpQSVhJLkRpc3BsYXlPYmplY3QsIGN1cnJlbnRQb3NpdGlvbjpQSVhJLlBvaW50LCBib2FyZExheW91dDpudW1iZXJbXVtdLCBzcXVhcmVTaXplOm51bWJlcik6UElYSS5Qb2ludCB7XG4gIGNvbnN0IGRpcmVjdGlvbjpESVJFQ1RJT04gPSBib2FyZExheW91dFtjdXJyZW50UG9zaXRpb24ueF1bY3VycmVudFBvc2l0aW9uLnldXG4gIGxldCBuZXh0UG9zaXRpb246UElYSS5Qb2ludFxuICBzd2l0Y2goZGlyZWN0aW9uKSB7XG4gICAgY2FzZSBESVJFQ1RJT04uVXA6XG4gICAgICBuZXh0UG9zaXRpb24gPSBuZXcgUElYSS5Qb2ludChjdXJyZW50UG9zaXRpb24ueCAtIDEsIGN1cnJlbnRQb3NpdGlvbi55KVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSBESVJFQ1RJT04uRG93bjpcbiAgICAgIG5leHRQb3NpdGlvbiA9IG5ldyBQSVhJLlBvaW50KGN1cnJlbnRQb3NpdGlvbi54ICsgMSwgY3VycmVudFBvc2l0aW9uLnkpXG4gICAgICBicmVhaztcbiAgICBjYXNlIERJUkVDVElPTi5MZWZ0OlxuICAgICAgbmV4dFBvc2l0aW9uID0gbmV3IFBJWEkuUG9pbnQoY3VycmVudFBvc2l0aW9uLngsIGN1cnJlbnRQb3NpdGlvbi55IC0gMSlcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgRElSRUNUSU9OLlJpZ2h0OlxuICAgICAgbmV4dFBvc2l0aW9uID0gbmV3IFBJWEkuUG9pbnQoY3VycmVudFBvc2l0aW9uLngsIGN1cnJlbnRQb3NpdGlvbi55ICsgMSlcbiAgICAgIGJyZWFrO1xuICB9XG4gIGNvbnN0IHBpeGVsUG9zaXRpb246UElYSS5Qb2ludCA9IGJvYXJkUG9zaXRpb25Ub1BpeGVscyhib2FyZExheW91dCwgc3F1YXJlU2l6ZSwgbmV4dFBvc2l0aW9uKVxuICBUd2VlbkxpdGUudG8oY2hlY2tlci5wb3NpdGlvbiwgLjMsIHt4OiBwaXhlbFBvc2l0aW9uLngsIHk6IHBpeGVsUG9zaXRpb24ueX0pXG4gIHJldHVybiBuZXh0UG9zaXRpb25cbn1cblxuZnVuY3Rpb24gdGVzdEVuZEdhbWUoYm9hcmRMYXlvdXQ6bnVtYmVyW11bXSwgY2hlY2tlcjFQb3NpdGlvbjpQSVhJLlBvaW50LCBjaGVja2VyMlBvc2l0aW9uOlBJWEkuUG9pbnQpOmJvb2xlYW4ge1xuICBsZXQgZW5kR2FtZTpib29sZWFuID0gZmFsc2VcbiAgaWYoIXZhbGlkUG9zaXRpb24oYm9hcmRMYXlvdXQsIGNoZWNrZXIxUG9zaXRpb24pKSB7XG4gICAgY29uc29sZS5pbmZvKCdUaGUgcGF0aCBpcyBub25jaXJjdWxhcicpXG4gICAgZW5kR2FtZSA9IHRydWVcbiAgfVxuICBlbHNlIGlmKHNhbWVQb3NpdGlvbihjaGVja2VyMVBvc2l0aW9uLCBjaGVja2VyMlBvc2l0aW9uKSkge1xuICAgIGNvbnNvbGUuaW5mbygnVGhlIHBhdGggaXMgY2lyY3VsYXInKVxuICAgIGVuZEdhbWUgPSB0cnVlXG4gIH1cbiAgcmV0dXJuIGVuZEdhbWVcbn1cblxuZnVuY3Rpb24gdmFsaWRQb3NpdGlvbihib2FyZExheW91dDpudW1iZXJbXVtdLCBwb3NpdGlvbjpQSVhJLlBvaW50KTpib29sZWFuIHtcbiAgcmV0dXJuICEoXG4gICAgcG9zaXRpb24ueCA8IDAgfHxcbiAgICBwb3NpdGlvbi54ID4gYm9hcmRMYXlvdXQubGVuZ3RoIC0gMSB8fFxuICAgIHBvc2l0aW9uLnkgPCAwIHx8XG4gICAgcG9zaXRpb24ueSA+IGJvYXJkTGF5b3V0WzBdLmxlbmd0aCAtIDFcbiAgKVxufVxuXG5mdW5jdGlvbiBzYW1lUG9zaXRpb24ocG9zaXRpb24xOlBJWEkuUG9pbnQsIHBvc2l0aW9uMjpQSVhJLlBvaW50KSB7XG4gIHJldHVybiBwb3NpdGlvbjEueCA9PT0gcG9zaXRpb24yLnggJiYgcG9zaXRpb24xLnkgPT09IHBvc2l0aW9uMi55XG59XG5cbmZ1bmN0aW9uIG5ld0JvYXJkTGF5b3V0KHJvd3MsIGNvbHMpOm51bWJlcltdW10ge1xuICBjb25zdCBib2FyZExheW91dDpudW1iZXJbXVtdID0gW11cbiAgZm9yKGxldCByb3c6bnVtYmVyID0gMCA7IHJvdyA8IHJvd3MgOyByb3crKykge1xuICAgIGJvYXJkTGF5b3V0LnB1c2goW10pXG4gICAgZm9yKGxldCBjb2w6bnVtYmVyID0gMCA7IGNvbCA8IGNvbHMgOyBjb2wrKykge1xuICAgICAgY29uc3QgYm9hcmRQb3NpdGlvbjpQSVhJLlBvaW50ID0gbmV3IFBJWEkuUG9pbnQocm93LCBjb2wpXG4gICAgICBjb25zdCBhcnJvd0RpcmVjdGlvbjpESVJFQ1RJT04gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KVxuICAgICAgYm9hcmRMYXlvdXRbcm93XS5wdXNoKGFycm93RGlyZWN0aW9uKVxuICAgIH1cbiAgfVxuICByZXR1cm4gYm9hcmRMYXlvdXRcbn1cblxuZnVuY3Rpb24gY3JlYXRlQm9hcmQoZ2FtZUJvYXJkOlBJWEkuQ29udGFpbmVyLCBib2FyZExheW91dDpudW1iZXJbXVtdLCBzcXVhcmVTaXplOm51bWJlcik6UElYSS5Db250YWluZXIge1xuICBjbGVhckNvbnRhaW5lcihnYW1lQm9hcmQpXG4gIGNvbnN0IHJvd3MgPSBib2FyZExheW91dC5sZW5ndGhcbiAgY29uc3QgY29scyA9IGJvYXJkTGF5b3V0WzBdLmxlbmd0aFxuICBsZXQgZXZlbjpib29sZWFuID0gZmFsc2VcbiAgZm9yKGxldCByb3c6bnVtYmVyID0gMCA7IHJvdyA8IHJvd3MgOyByb3crKykge1xuICAgIGZvcihsZXQgY29sOm51bWJlciA9IDAgOyBjb2wgPCBjb2xzIDsgY29sKyspIHtcbiAgICAgIGNvbnN0IGJvYXJkUG9zaXRpb246UElYSS5Qb2ludCA9IG5ldyBQSVhJLlBvaW50KHJvdywgY29sKVxuICAgICAgY29uc3Qgc3F1YXJlOlBJWEkuR3JhcGhpY3MgPSBjcmVhdGVTcXVhcmUoc3F1YXJlU2l6ZSwgZXZlbilcbiAgICAgIHNxdWFyZS5wb3NpdGlvbiA9IGJvYXJkUG9zaXRpb25Ub1BpeGVscyhib2FyZExheW91dCwgc3F1YXJlU2l6ZSwgYm9hcmRQb3NpdGlvbilcbiAgICAgIGdhbWVCb2FyZC5hZGRDaGlsZChzcXVhcmUpXG4gICAgICBzcXVhcmUuYWRkQ2hpbGQoY3JlYXRlQXJyb3coc3F1YXJlU2l6ZSwgYm9hcmRMYXlvdXRbcm93XVtjb2xdKSlcbiAgICAgIGV2ZW4gPSAhZXZlblxuICAgIH1cbiAgICBpZihyb3dzICUgMiA9PT0gMClcbiAgICAgIGV2ZW4gPSAhZXZlblxuICB9XG4gIHJldHVybiBnYW1lQm9hcmRcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3F1YXJlKHNpemU6bnVtYmVyLCBldmVuOmJvb2xlYW4pOlBJWEkuR3JhcGhpY3Mge1xuICBjb25zdCBzcXVhcmU6UElYSS5HcmFwaGljcyA9IG5ldyBQSVhJLkdyYXBoaWNzKClcbiAgc3F1YXJlLmJlZ2luRmlsbChldmVuID8gQ09MT1JfRVZFTiA6IENPTE9SX09ERClcbiAgc3F1YXJlLmRyYXdSZWN0KC1zaXplIC8gMiwgLXNpemUgLyAyLCBzaXplLCBzaXplKVxuICBzcXVhcmUuZW5kRmlsbCgpXG4gIHJldHVybiBzcXVhcmVcbn1cblxuZnVuY3Rpb24gY3JlYXRlQXJyb3coc2l6ZTpudW1iZXIsIGRpcmVjdGlvbjpESVJFQ1RJT04pOlBJWEkuR3JhcGhpY3Mge1xuICBjb25zdCBhcnJvdzpQSVhJLkdyYXBoaWNzID0gbmV3IFBJWEkuR3JhcGhpY3MoKVxuICBhcnJvdy5iZWdpbkZpbGwoQ09MT1JfQVJST1cpXG4gIGFycm93LmRyYXdSZWN0KC1zaXplIC8gMTIsIC1zaXplICogLjIsIHNpemUgLyA2LCBzaXplICogLjYpXG4gIGFycm93LmRyYXdQb2x5Z29uKFtcbiAgICBuZXcgUElYSS5Qb2ludCgwLCAtc2l6ZSAqIC40KSxcbiAgICBuZXcgUElYSS5Qb2ludCgtc2l6ZSAqIC4yNSwgLXNpemUgKiAuMSksXG4gICAgbmV3IFBJWEkuUG9pbnQoc2l6ZSAqIC4yNSwgLXNpemUgKiAuMSlcbiAgXSlcbiAgYXJyb3cuZW5kRmlsbCgpXG4gIGFycm93LnJvdGF0aW9uID0gTWF0aC5QSSAvIDIgKiBkaXJlY3Rpb25cbiAgcmV0dXJuIGFycm93XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNoZWNrZXIoc2l6ZTpudW1iZXIpOlBJWEkuR3JhcGhpY3Mge1xuICBjb25zdCBjaGVja2VyOlBJWEkuR3JhcGhpY3MgPSBuZXcgUElYSS5HcmFwaGljcygpXG4gIGNoZWNrZXIuYWxwaGEgPSAuNzVcbiAgY2hlY2tlci5iZWdpbkZpbGwoQ09MT1JfQ0hFQ0tFUilcbiAgY2hlY2tlci5kcmF3Q2lyY2xlKDAsIDAsIHNpemUgKiAuMylcbiAgY2hlY2tlci5lbmRGaWxsKClcbiAgcmV0dXJuIGNoZWNrZXJcbn1cblxuZnVuY3Rpb24gYm9hcmRQb3NpdGlvblRvUGl4ZWxzKGJvYXJkTGF5b3V0Om51bWJlcltdW10sIHNpemU6bnVtYmVyLCBib2FyZFBvc2l0aW9uOlBJWEkuUG9pbnQpOlBJWEkuUG9pbnQge1xuICByZXR1cm4gbmV3IFBJWEkuUG9pbnQoXG4gICAgKGJvYXJkUG9zaXRpb24ueSAtIGJvYXJkTGF5b3V0WzBdLmxlbmd0aCAvIDIpICogc2l6ZSxcbiAgICAoYm9hcmRQb3NpdGlvbi54IC0gYm9hcmRMYXlvdXQubGVuZ3RoIC8gMikgKiBzaXplXG4gIClcbn1cblxuZnVuY3Rpb24gcmFuZG9tUG9zaXRpb24oYm9hcmRMYXlvdXQ6bnVtYmVyW11bXSk6UElYSS5Qb2ludCB7XG4gIHJldHVybiBuZXcgUElYSS5Qb2ludChcbiAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGJvYXJkTGF5b3V0Lmxlbmd0aCksXG4gICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBib2FyZExheW91dFswXS5sZW5ndGgpXG4gIClcbn1cblxuZnVuY3Rpb24gY2xlYXJDb250YWluZXIoY29udGFpbmVyOlBJWEkuQ29udGFpbmVyKTp2b2lkIHtcbiAgY29udGFpbmVyLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24oY2hpbGQ6UElYSS5EaXNwbGF5T2JqZWN0KSB7IGNoaWxkLmRlc3Ryb3koKSB9KVxuICBjb250YWluZXIucmVtb3ZlQ2hpbGRyZW4oKVxufVxuXG5mdW5jdGlvbiByZW5kZXJMb29wKHJlbmRlcmVyOlBJWEkuV2ViR0xSZW5kZXJlciwgc3RhZ2U6UElYSS5Db250YWluZXIpOnZvaWQge1xuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiByZW5kZXJMb29wKHJlbmRlcmVyLCBzdGFnZSkpXG4gICAgcmVuZGVyZXIucmVuZGVyKHN0YWdlKVxufVxuIl19
